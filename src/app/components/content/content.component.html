<section class="sub-container">
  <!-- Placeholder when no group is selected -->
  <div *ngIf="!selectedGroup && !showSettings" class="placeholder-message">
    <div class="p-m">
      <h2>No Group Selected</h2>
      <p>Please select a group to view its channels and messages.</p>
    </div>
  </div>

  <!-- Group details and channels when a group is selected -->
  <div class="channel-container" *ngIf="selectedGroup && !showSettings">
    <div class="group-header container pb-0">
      <h2>Group: "{{ selectedGroup.name }}"</h2>
      <div class="d-flex justify-content-between">
        <p>Description: {{ selectedGroup.description }}</p>

        <!-- Button to Navigate to Settings -->
        <div *ngIf="isAdmin()">
          <button class="btn btn-sm btn-primary ms-1" (click)="toSettings()">
            <i class="bi bi-three-dots"></i>
          </button>
        </div>
      </div>


      <!-- Channels Section -->
      <div class="channel-container-btn mt-3">
        <h5>&#64;Channels</h5>
        <div class="ctrl-sim-btn" *ngIf="isAdmin()">
          <button class="btn btn-success btn-sm d-flex justify-content-center align-items-center" data-bs-toggle="modal"
            data-bs-target="#channelModal">
            <span class="material-symbols-outlined">add</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Request to Join Button -->
    <button class="btn btn-sm btn-primary ms-1 mt-3" *ngIf="!isUser()" (click)="requestToJoin()">
      Request to Join
    </button>


    <!-- List Channels if the user is part of the group -->
    <ul class="list-group" *ngIf="isUser()">
      <li class="list-group-item clickable" *ngFor="let channel of selectedGroup?.channels"
        (click)="selectChannel(channel)">
        # {{ channel.name }}
        <button class="btn btn-sm btn-danger ms-1 d-flex justify-content-center align-items-center" *ngIf="isAdmin()"
          (click)="confirmDeleteChannel(channel)">
          <span class="material-symbols-outlined">delete</span>
        </button>
      </li>
    </ul>
  </div>

  <!-- Message Container -->
  <div class="message-container mt-4" *ngIf="selectedChannel && !showSettings && isUser()">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0"># {{ selectedChannel.name }}</h4>
    </div>
    <p class="mx-4">Description: {{ selectedChannel.description }}</p>

    <!-- Display Messages -->
    <div class="container-fluid p-0 mt-4">
      <h5 class=" mb-4">Messages:</h5>
      <div class="messages-list">
        <!-- Iterate over each message in the messages array -->
        <div class="card mb-2 rounded-bottom p-0" *ngFor="let message of selectedChannel?.messages">
          <div class="card-header p-2 bg-warning d-flex flex-row justify-content-start align-items-center">
            <img
            [src]="userMap[message.userId].profilePictureUrl || 'https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3.webp'"
              alt="Selected Image"
              class=" rounded-circle p-0 overflow-hidden" 
              style="width: 45px; height: 45px;" />
  
            <p class="card-title m-0 ps-2"><strong>{{ message.name }}</strong></p>
          </div>
          <div class="card-body p-1 rounded-bottom">
            <div class="p-2">
              <p class="card-text">{{ message.text }}</p>
            </div>
            <div class="d-flex justify-content-end align-items-end">
              <div class="me-2">
                <p class="card-text small mb-0">
                  Time: {{ message.timestamp | date:'hh:mm a' }}
                </p>
                <p class="card-text small mb-0">
                  Date: {{ message.timestamp | date:'dd/MM/yy' }}
                </p>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- Message Form -->
    <div class="mt-4">
      <form class="mb-3" (submit)="chat($event)">
        <div class="form-group mb-2">
          <label for="newMessage" class="form-label">New Message</label>
          <span class="d-flex flex-row">
            <input type="text" [(ngModel)]="newMessage" name="newMessage" id="newMessage" class="form-control"
              placeholder="Type your message here">
            <button type="submit" class="btn btn-sm btn-primary">Send</button>
          </span>
        </div>

      </form>
    </div>

  </div>

  <!-- Settings Component -->
  <app-settings *ngIf="showSettings && selectedGroup" [selectedGroup]="selectedGroup"
    (close)="closeSettings()"></app-settings>
</section>

<!-- Modal to Add New Channel -->
<div class="modal fade" id="channelModal" tabindex="-1" aria-labelledby="channelModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="channelModalLabel">Add New Channel</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="channelName" class="form-label">Channel Name</label>
          <input type="text" class="form-control" id="channelName" [(ngModel)]="newChannelName">
        </div>
        <div class="mb-3">
          <label for="channelDescription" class="form-label">Channel Description</label>
          <textarea class="form-control" id="channelDescription" [(ngModel)]="newChannelDescription"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" (click)="addNewChannel()" data-bs-dismiss="modal">Save
          Channel</button>
      </div>
    </div>
  </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete the channel "{{ channelToDelete?.name }}"?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="onConfirmDelete()" data-bs-dismiss="modal">Delete</button>
      </div>
    </div>
  </div>
</div>